<!-- Please do not edit this file directly; it was generated with the
     tools/test_case_gen script using the following configuration as input:
     tools/pi_image_cases.xml
-->

    <p>This test case is to be carried out on a Raspberry Pi Compute Module 4 2GB.</p>
    <p>Follow the installation steps at <a href="https://ubuntu.com/download/iot/installation-media">
      IoT installation media</a>
    </p>
    
      <p>Before booting your CM4 with the new image, edit config.txt on the boot
      (1st) partition and uncomment the <code>#dtoverlay=dwc2,dr_mode=host</code>
      line to ensure the USB ports on the IO board operate correctly</p>
    
    <dl>
      
    
    <dt>
      Immediately after the "rainbow" splash screen, U-Boot starts. Press a key
      to interrupt the sequence, then type "boot" to continue it.
    </dt>
    <dd>
      Check that the U-Boot prompt (including a two-second wait) appears on
      the primary monitor connected to the Pi, that the keyboard will interrupt
      the sequence, and that boot successfully concludes after resumption.
    </dd>
  
    
    <dt>
      During the boot sequence, U-Boot starts interacting via serial (GPIO14
      and GPIO15, pins 8 and 10 respectively, on the 40-pin GPIO header). Press
      a key to interrupt the sequence, then type "boot" to continue it.
    </dt>
    <dd>
      Check that the U-Boot prompt (including a two-second wait) appears on
      the attached serial console, that the keyboard will interrupt
      the sequence, and that boot successfully concludes after resumption.
    </dd>
  
    
    <dt>
      Run <code>sudo flash-kernel</code>
    </dt>
    <dd>
      Exit code is clean (0) and no error messages are reported
    </dd>
  
    
    <dt>
      Run <code>sudo reboot</code>
    </dt>
    <dd>
      System reboots successfully to a login prompt
    </dd>
  
    
    <dt>
      Run <code>sudo shutdown -h now</code>
    </dt>
    <dd>
      System shuts down in a reasonable time (less than a minute)
    </dd>
  
    
    <dt>
      Check output of <code>free -h</code>
    </dt>
    <dd>
      Reported "Mem" under "total" is consistent with a
      Raspberry Pi Compute Module 4 2GB. It should be in the region of 1.6-1.8GB.
    </dd>
  
    
    <dt>
      Perform a large (300-600MB) file copy to USB storage
      <ul>
        <li>Generate a large (500MB) file: <code>dd if=/dev/urandom of=rubbish
          bs=1M count=500</code></li>
        <li>Insert a USB stick (appropriately sized) into a spare USB port</li>
        <li>Make a mount directory: <code>sudo mkdir /mnt/stick</code></li>
        <li>Mount the stick: <code>sudo mount /dev/sda1 /mnt/stick</code>
          (modify mount-point as necessary; check <code>sudo dmesg</code>
          output if unsure)</li>
        <li>Copy the file: <code>sudo cp rubbish /mnt/stick/</code></li>
        <li>Unmount the stick: <code>sudo umount /mnt/stick</code></li>
        <li>Remove the stick from the USB port</li>
        <li>Re-insert the stick into the USB port</li>
        <li>Re-mount the stick: <code>sudo mount /dev/sda1 /mnt/stick</code>
          (again, adjust mount-point as necessary)</li>
        <li>Compare the copied file to that on the stick: <code>cmp rubbish
          /mnt/stick/rubbish</code></li>
      </ul>
    </dt>
    <dd>
      <code>cmp</code> returns 0 and outputs nothing indicating the files are
      identical
    </dd>
  
    
    <dt>
      With an HDMI monitor that supports audio plugged into
      the HDMI0 output, and an available MP3 file:
      <ul>
        <li>Install mpg321 and amixer with <code>sudo apt install mpg321
          alsa-utils</code></li>
        <li>Find the correct hardware output for the HDMI0 port:
          <code>cat /proc/asound/cards</code> and note the number at the start
          of the line for the HDMI0 port (usually 0 and possibly
          1 for any connected monitor(s), and 1 or possibly 2 for the headphone
          jack)</li>
        <li>Attempt to play your MP3 file with: <code>mpg321 -o alsa -a
          hw:<em>num</em>,0 <em>music.mp3</em></code> substituting
          <em>num</em> for the number found during the previous step, and
          <em>music.mp3</em> for your choice of MP3 file, e.g. <code>mpg321 -o
          alsa -a hw:0,0 "Jeff Wayne - War of the
          Worlds.mp3"</code></li>
        <li>Use <tt>Ctrl+C</tt> to end playback early, if you wish</li>
        <li>If you cannot hear anything, first check that the mixer's volume is
          not set too low; run <code>alsamixer</code>, and adjust the volume
          (<tt>J</tt> for down, <tt>K</tt> for up) before exiting
          (<tt>Esc</tt>) and retrying playback</li>
      </ul>
    </dt>
    <dd>Audio can be heard through the device</dd>
  
    
    <dt>
      With an HDMI monitor that supports audio plugged into
      the HDMI1 output, and an available MP3 file:
      <ul>
        <li>Install mpg321 and amixer with <code>sudo apt install mpg321
          alsa-utils</code></li>
        <li>Find the correct hardware output for the HDMI1 port:
          <code>cat /proc/asound/cards</code> and note the number at the start
          of the line for the HDMI1 port (usually 0 and possibly
          1 for any connected monitor(s), and 1 or possibly 2 for the headphone
          jack)</li>
        <li>Attempt to play your MP3 file with: <code>mpg321 -o alsa -a
          hw:<em>num</em>,0 <em>music.mp3</em></code> substituting
          <em>num</em> for the number found during the previous step, and
          <em>music.mp3</em> for your choice of MP3 file, e.g. <code>mpg321 -o
          alsa -a hw:0,0 "Jeff Wayne - War of the
          Worlds.mp3"</code></li>
        <li>Use <tt>Ctrl+C</tt> to end playback early, if you wish</li>
        <li>If you cannot hear anything, first check that the mixer's volume is
          not set too low; run <code>alsamixer</code>, and adjust the volume
          (<tt>J</tt> for down, <tt>K</tt> for up) before exiting
          (<tt>Esc</tt>) and retrying playback</li>
      </ul>
    </dt>
    <dd>Audio can be heard through the device</dd>
  
    
    <dt>
      Check auto-configuration of ethernet
      <ul>
        <li>Run <code>ip addr</code></li>
        <li>Check that a valid IP address is recorded on the eth0 interface</li>
        <li>Check <code>ping google.com</code> successfully pings a few times
          (<tt>Ctrl+C</tt> to cancel)</li>
      </ul>
    </dt>
    <dd>
      The "eth0" interface should have a DHCP
      assigned IP address and you should be able to ping google.com
    </dd>
  
    
    <dt>
      Configure wifi via netplan
      <ul>
        <li>Place the following in <code>/etc/netplan/wifi.yaml</code>
        (substituting the SSID and password as necessary):</li>
        <li><pre>
      network:
        version: 2
          wifis:
            wlan0:
              dhcp4: true
              access-points:
                my-ssid-here:
                  password: my-password-here</pre>
        </li>
        <li>Run <code>sudo netplan apply</code></li>
        <li>Wait a few seconds (to allow DHCP to complete), then run <code>ip
          addr</code></li>
        <li>Check that a valid IP address is recorded on the wlan0 interface</li>
        <li>Check <code>ping google.com</code> successfully pings a few times
          (<tt>Ctrl+C</tt> to cancel)</li>
      </ul>
    </dt>
    <dd>
      The "wlan0" interface should have a DHCP
      assigned IP address and you should be able to ping google.com
    </dd>
  
  
    </dl>
    <p>If <strong>all</strong> actions produce the expected results listed,
      please <a href="results#add_result">submit</a> a 'passed' result.</p>
    <p>If <strong>any</strong> action fails, or produces an unexpected result,
      please <a href="results#add_result">submit</a> a 'failed' result and <a href="../../buginstructions">file a bug</a>. Please be sure to include
      the bug number when you <a href="results#add_result">submit</a> your
      result.</p>
  